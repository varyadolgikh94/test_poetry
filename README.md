# Проект виджета банковских операций

## Описание:

Проект виджета банковских операций - бэкэнд-проект, направленный на
подготовку данных для отображения в новом виджете, который показывает
несколько последних успешных банковских транзакций клиента.

## Установка:

1. Клонируйте репозиторий:

```
git@github.com:varyadolgikh94/test_poetry.git
```

2. Установите зависимости:

```
pip install -r requirements.txt
```

3. Чтобы воспользоваться функцией маскировки, перейдите в src/widget.py,
   вызовите функцию Mask_account_card и передайте ей соответствующие данные
   в форме «ваша_карта_имя_номер_карты» для карт или «Счет account_number»
   для учетных записей. Не забудьте распечатать результат:

```
your_card = "your_card_name card_number"
print(mask_account_card("your card"))
your_account = "Счет account_number"
print(mask_account_card("your account"))
```

4. Перейдите в src/processing.py и создайте список dicts, содержащий информацию
   о ваших последних операциях в форме {"id": Operation_id,
   "state": "EXECUTED"/"CANCELED", "date": "operation_date"} .
   Передайте эти данные в функцию filter_by_state, чтобы видеть только
   «ИСПОЛНЕННЫЕ» операции, или укажите состояние фильтрации, передав второй
   параметр state="CANCELED". Вызовите функцию sort_by_date, чтобы просмотреть
   свои операции в нисходящем хронологическом порядке (от самых последних к самым
   ранним). Чтобы просмотреть операции в порядке возрастания, передайте второй
   параметрparameter="False":

```
operations_data = [
{"id": operation1_id, "state": "EXECUTED", "date": "operation1_date"}, 
{"id": operation2_id, "state": "CANCELED", "date": "operation2_date"}
]
print(filter_by_state(operations_data)) # выводит только выполненные операции
print(filter_by_state(operations_data, state="CANCELED")) # выводит только отмененные операции
print(sort_by_date(operations_data)) # выводит операции в хронологическом порядке от самых последних к более ранним
print(sort_by_date(operations_data, parameter=False)) # выводит операции от более ранних до самых последних
```

5. Модуль src/generators.py создан для фильтрации и генерации данных.
   Создайте список dicts, содержащий полную информацию о ваших операциях, включая идентификатор
   операции id, state, date, OperationAmount и описание и т. д. Укажите интересующую валюту и
   передайте оба параметра в функцию filter_by_currency. Распечатайте информацию о соответствующих
   операциях одну за другой, используя next(). Если вы хотите видеть только описания операций, вы можете
   передать отфильтрованный или исходный список в функцию transaction_descriptions, а затем распечатать
   результаты так же, как вы это делали с функцией filter_by_currency. ПРИМЕЧАНИЕ! Если вы хотите видеть
   только описание отфильтрованных операций, не забудьте преобразовать вывод функции в список перед передачей
   его в функцию filter_by_currency. Функция card_number_generator используется для генерации номеров карт
   от 0000000000000001 до 9999999999999999 в указанном диапазоне. Чтобы использовать его, просто передайте
   начальный и конечный номера карты и распечатайте результат.

```
transactions = [
     {
         "идентификатор": 142264268,
         "состояние": "ИСПОЛНЕНО",
         "дата": "2019-04-04T23:20:05.206878",
         "operationAmount": {"amount": "79114,93", "currency": {"name": "USD", "code": "USD"}},
         "description": "Перевод счета на счет",
         "от": "Счет 19708645243227258542",
         "кому": "Счет 75651667383060284188",
     },
     {
         "идентификатор": 873106923,
         "состояние": "ИСПОЛНЕНО",
         "дата": "2019-03-23T01:09:46.296404",
         "operationAmount": {"сумма": "43318,34", "валюта": {"имя": "руб.", "код": "РУБ"}},
         "description": "Перевод счета на счет",
         "от": "Счет 44812258784861134719",
         "кому": "Счет 74489636417521191160",
     },
]

usd_transactions = filter_by_currency(transactions, "USD") # создаёт фильтр транзакций 
print(next(usd_transactions)) # выводит первую транзакцию в долларах США

usd_transactions = list(filter_by_currency(transactions, "USD")) # создаёт список транзакций в долларах США
usd_descriptions = транзакции_descriptions(usd_transactions) # генерирует описания транзакций в долларах США
print(next(usd_descriptions)) # выводит описание первой транзакции в долларах США

card_numbers_list = list(card_number для card_number в card_number_generator(1, 5))
print(card_numbers_list) # выводит список номеров карт от «0000 0000 0000 0001» до «0000 0000 0000 0005»
```

6. Модуль src/decorators.py содержит декоратор журналирования функций, 
который регистрирует время начала и окончания функции, результат выполнения и информацию об ошибках. 
Чтобы использовать его, просто поместите декоратор над вашей функцией и затем запустите его. 
Если вы хотите, чтобы логи записывались в отдельный файл, передайте декоратору имя файла.

```
# logs are printed to the console
@log
def your_func():
    ....

# logs are written in a special file
@log("file.txt")
def your_func():
    ....
```

## Использование:

1. Функция маскировки:

```
# Card usage example
Visa Platinum 7000 7922 8960 6361  # input data
Visa Platinum 7000 79** **** 6361  # output data

# Account usage example
Счет 73654108430135874305  # input data
Счет **4305  # output data
```

2. Функция фильтрации

```
# Вывод функции с состоянием по умолчанию 'EXECUTED'
[
{'id': 41428829, 'state': 'EXECUTED', 'date': '2019-07-03T18:35:29.512364'}, 
{'id': 939719570, 'state': 'EXECUTED', 'date': '2018-06-30T02:08:58.425572'}
] 

# Function output with 'CANCELED' passed as the second argument
[
{'id': 594226727, 'state': 'CANCELED', 'date': '2018-09-12T21:27:25.241689'}, 
{'id': 615064591, 'state': 'CANCELED', 'date': '2018-10-14T08:21:33.419441'}
]
```

3. Функция сортировки:

```
# Вывод функции (сортировка по убыванию, т.е. от самых последних операций)
[
{'id': 41428829, 'state': 'EXECUTED', 'date': '2019-07-03T18:35:29.512364'}, 
{'id': 615064591, 'state': 'CANCELED', 'date': '2018-10-14T08:21:33.419441'}, 
{'id': 594226727, 'state': 'CANCELED', 'date': '2018-09-12T21:27:25.241689'}, 
{'id': 939719570, 'state': 'EXECUTED', 'date': '2018-06-30T02:08:58.425572'}
]
```

4. Фильтрация по функции валюты:

```
usd_transactions = filter_by_currency(transactions, "USD")
for _ in range(2):
    print(next(usd_transactions))

>>> {
          "id": 939719570,
          "state": "EXECUTED",
          "date": "2018-06-30T02:08:58.425572",
          "operationAmount": {
              "amount": "9824.07",
              "currency": {
                  "name": "USD",
                  "code": "USD"
              }
          },
          "description": "Перевод организации",
          "from": "Счет 75106830613657916952",
          "to": "Счет 11776614605963066702"
      }
      {
              "id": 142264268,
              "state": "EXECUTED",
              "date": "2019-04-04T23:20:05.206878",
              "operationAmount": {
                  "amount": "79114.93",
                  "currency": {
                      "name": "USD",
                      "code": "USD"
                  }
              },
              "description": "Перевод со счета на счет",
              "from": "Счет 19708645243227258542",
              "to": "Счет 75651667383060284188"
       }
```

5. Генератор описаний транзакций:

```
descriptions = transaction_descriptions(transactions)
for _ in range(5):
    print(next(descriptions))

>>> Перевод организации
    Перевод со счета на счет
    Перевод со счета на счет
    Перевод с карты на карту
    Перевод организации
```

6. Генератор номеров карт:

```
for card_number in card_number_generator(21, 25):
    print(card_number)

>>> 0000 0000 0000 0021
    0000 0000 0000 0022
    0000 0000 0000 0023
    0000 0000 0000 0024
    0000 0000 0000 0025
```

## Тесты:

Проект протестирован 47 различными способами, что обеспечивает 100% покрытие кода.
Тестирование проекта выполняется с помощью pytest. Чтобы запустить тесты,
установите pytest в группу разработки и напишите соответствующую команду в своем терминале:

```
poetry add --group dev pytest
pytest
```

Чтобы просмотреть статистику покрытия кода, установите pytest-cov поэзию,
добавьте --group dev pytest-cov и введите pytest --cov в своем терминале.


